<!DOCTYPE html>
<!--TRIPOD-IP-DECLARATION-v1.0|David Lee Wise|TriPod LLC|SHA256:02880745b847317c4e2424524ec25d0f7a2b84368d184586f45b54af9fcab763-->
<html lang="en"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>TOPH // CORTEX SUITE</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&display=swap');
*{margin:0;padding:0;box-sizing:border-box;-webkit-user-select:none;user-select:none}
input,textarea{-webkit-user-select:text;user-select:text}
:root{
  --pu:#ee00ff;--pug:rgba(238,0,255,.9);--pu2:rgba(238,0,255,.15);
  --gn:#00ffe5;--gng:rgba(0,255,229,.85);--gn2:rgba(0,255,229,.15);
  --pk:#ff00aa;--pkg:rgba(255,0,170,.8);
  --yw:#ffe000;--yg:rgba(255,224,0,.8);
  --cy:#00ffff;--cyg:rgba(0,255,255,.85);
  --glass:rgba(0,14,12,.93);--glass2:rgba(0,20,16,.96);
}
html,body{height:100%;overflow:hidden;background:linear-gradient(135deg,#00e0d4 0%,#00c8b8 35%,#00b4a6 65%,#00d0c8 100%);font-family:'Share Tech Mono',monospace;cursor:crosshair;color:var(--gn)}
button,input,textarea,select{cursor:crosshair;font-family:'Share Tech Mono',monospace}
#bgc,#trailc{position:fixed;inset:0;z-index:0;pointer-events:none}
#trailc{z-index:2}
.vl{position:fixed;inset:0;z-index:1;pointer-events:none;background-image:repeating-linear-gradient(90deg,rgba(0,255,229,.07) 0,rgba(0,255,229,.07) 1px,transparent 1px,transparent 44px)}
.hl{position:fixed;inset:0;z-index:1;pointer-events:none;background-image:repeating-linear-gradient(0deg,rgba(238,0,255,.06) 0,rgba(238,0,255,.06) 1px,transparent 1px,transparent 28px)}
.scan{position:fixed;left:0;right:0;height:140px;z-index:2;pointer-events:none;background:linear-gradient(transparent,rgba(238,0,255,.1),rgba(0,255,229,.06),transparent);animation:sc 4s linear infinite;top:-180px}
@keyframes sc{to{top:110vh}}

/* HDR */
#hdr{position:fixed;top:0;left:0;right:0;height:48px;z-index:1000;display:flex;align-items:center;justify-content:space-between;padding:0 16px;background:rgba(0,10,8,.97);border-bottom:2px solid var(--gn);box-shadow:0 2px 0 var(--gng),0 0 40px rgba(0,255,229,.3)}
#hdr::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--pu),var(--gn),var(--cy),var(--yw),var(--gn),var(--pu),var(--pk));background-size:200%;animation:hb 5s linear infinite}
@keyframes hb{0%{background-position:0%}100%{background-position:200%}}
.logo{font-family:'Orbitron',monospace;font-weight:900;font-size:16px;letter-spacing:4px;color:var(--cy);text-shadow:0 0 20px var(--cyg),0 0 6px #fff}
.logo em{color:var(--gn);font-style:normal;text-shadow:0 0 20px var(--gng),0 0 6px #fff}
.logo-sub{font-size:8px;color:rgba(0,255,229,.5);letter-spacing:3px;margin-top:1px}
.hs{text-align:center}.hs-v{display:block;font-family:'Orbitron',monospace;font-size:15px;font-weight:900;line-height:1}
.hs-k{display:block;font-size:8px;letter-spacing:2px;color:rgba(0,255,229,.45);margin-top:1px}
.gn{color:var(--gn);text-shadow:0 0 14px var(--gng),0 0 4px #fff}
.pu{color:var(--pu);text-shadow:0 0 12px var(--pug)}
.yw{color:var(--yw);text-shadow:0 0 12px var(--yg)}
.pk{color:var(--pk);text-shadow:0 0 10px var(--pkg)}
.cy{color:var(--cy);text-shadow:0 0 12px var(--cyg)}
.hdr-stats{display:flex;gap:14px;align-items:center}
.rbtn{padding:3px 10px;background:transparent;border:1px solid rgba(0,255,229,.4);color:rgba(0,255,229,.7);font-size:9px;letter-spacing:2px;transition:all .15s}
.rbtn:hover{border-color:var(--gn);color:var(--gn);box-shadow:0 0 16px rgba(0,255,229,.4)}
#status-dot{width:8px;height:8px;border-radius:50%;background:var(--yw);box-shadow:0 0 10px var(--yg);transition:all .3s;flex-shrink:0}
#status-dot.online{background:var(--gn);box-shadow:0 0 10px var(--gng)}
#status-dot.thinking{background:var(--pu);box-shadow:0 0 10px var(--pug);animation:pulse .6s ease infinite alternate}
@keyframes pulse{to{transform:scale(1.5);opacity:.7}}

/* WORKSPACE */
#workspace{position:fixed;left:0;top:48px;right:0;bottom:0;z-index:3;overflow:hidden}

/* FLOATING PANELS */
.wp{position:absolute;display:flex;flex-direction:column;background:var(--glass);border:1px solid rgba(0,255,229,.28);min-width:180px;min-height:80px;overflow:hidden;box-shadow:0 6px 32px rgba(0,0,0,.7),inset 0 1px 0 rgba(0,255,229,.1)}
.wp.focused{border-color:var(--gn);box-shadow:0 6px 40px rgba(0,0,0,.8),0 0 30px rgba(0,255,229,.25),0 0 2px var(--gng)}
.wp::before{content:'';position:absolute;top:0;left:0;bottom:0;width:3px;background:linear-gradient(180deg,var(--gn),var(--cy),var(--pu),var(--pk));box-shadow:0 0 12px var(--gng)}
.wp::after{content:'';position:absolute;top:0;right:0;width:16px;height:16px;border-top:2px solid var(--pu);border-right:2px solid var(--pu);box-shadow:5px -5px 12px rgba(238,0,255,.5);pointer-events:none}
.wp-hdr{display:flex;justify-content:space-between;align-items:center;padding:6px 10px 6px 14px;border-bottom:1px solid rgba(0,255,229,.15);background:linear-gradient(90deg,rgba(0,255,229,.08),rgba(238,0,255,.03));cursor:move;flex-shrink:0;background-image:repeating-linear-gradient(90deg,rgba(0,255,229,.04) 0,rgba(0,255,229,.04) 1px,transparent 1px,transparent 6px)}
.wp-hdr:hover{background:rgba(0,255,229,.1)}
.wp-title{font-family:'Orbitron',monospace;font-size:9px;letter-spacing:3px;color:var(--gn);text-shadow:0 0 14px var(--gng),0 0 3px #fff;pointer-events:none}
.wp-tag{font-size:9px;color:rgba(0,255,229,.55);letter-spacing:1px;pointer-events:none}
.wp-min{width:14px;height:14px;border:1px solid rgba(0,255,229,.3);background:transparent;color:rgba(0,255,229,.6);font-size:9px;cursor:crosshair;display:flex;align-items:center;justify-content:center;transition:all .12s;padding:0}
.wp-min:hover{border-color:var(--gn);color:var(--gn);box-shadow:0 0 8px var(--gng)}
.wp.min .wp-body{display:none!important}
.wp-body{flex:1;overflow-y:auto;padding:8px 8px 8px 13px;min-height:0;scrollbar-width:thin;scrollbar-color:rgba(0,255,229,.3) transparent}
.wp-body::-webkit-scrollbar{width:3px}
.wp-body::-webkit-scrollbar-thumb{background:linear-gradient(var(--gn),var(--cy),var(--pu))}
.wp-resize{position:absolute;bottom:0;right:0;width:14px;height:14px;cursor:se-resize;z-index:9;background:radial-gradient(circle,rgba(0,255,229,.5) 1.5px,transparent 1.5px),radial-gradient(circle,rgba(0,255,229,.3) 1.5px,transparent 1.5px),radial-gradient(circle,rgba(0,255,229,.15) 1.5px,transparent 1.5px);background-size:5px 5px;background-position:2px 2px,6px 6px,10px 10px;background-repeat:no-repeat}
.div1{height:1px;background:linear-gradient(90deg,transparent,var(--gn),var(--cy),var(--pu),transparent);margin:7px 0;opacity:.6}
.lbl{font-size:9px;color:rgba(0,255,229,.4);letter-spacing:2px;margin:8px 0 4px}
.row{display:flex;justify-content:space-between;align-items:center;padding:4px 0;border-bottom:1px solid rgba(0,255,229,.07)}
.rk{font-size:10px;color:rgba(0,255,229,.5);letter-spacing:1px}
.rv{font-size:12px;font-weight:700;color:#fff}
.inp{width:100%;padding:7px 8px;background:rgba(0,255,229,.07);border:1px solid rgba(0,255,229,.3);color:#fff;font-size:12px;outline:none;display:block;margin-bottom:5px}
.inp:focus{border-color:var(--gn);background:rgba(0,255,229,.1)}
.inp::placeholder{color:rgba(0,255,229,.2)}
textarea.inp{resize:none;line-height:1.8}
select.inp{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='6'%3E%3Cpath d='M0 0l4 6 4-6z' fill='%2300ffe5'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:calc(100% - 8px) center}
.btn{padding:7px 10px;background:transparent;font-size:10px;letter-spacing:2px;cursor:crosshair;transition:all .18s;border:1px solid;position:relative;overflow:hidden;font-weight:700;clip-path:polygon(0 0,calc(100% - 5px) 0,100% 5px,100% 100%,5px 100%,0 calc(100% - 5px))}
.btn::before{content:'';position:absolute;left:-100%;top:0;bottom:0;width:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.1),transparent);transition:left .2s}
.btn:hover::before{left:100%}
.bgn{border-color:var(--gn);color:var(--gn)}.bgn:hover{background:var(--gn2)}
.bpu{border-color:var(--pu);color:var(--pu)}.bpu:hover{background:var(--pu2)}
.byw{border-color:var(--yw);color:var(--yw)}.byw:hover{background:rgba(255,224,0,.1)}
.bpk{border-color:var(--pk);color:var(--pk)}.bpk:hover{background:rgba(255,0,170,.08)}
.bcy{border-color:var(--cy);color:var(--cy)}.bcy:hover{background:rgba(0,255,255,.08)}
.notif{position:fixed;bottom:16px;right:16px;z-index:99999;padding:10px 16px;border:1px solid;font-size:12px;letter-spacing:2px;font-weight:700;background:rgba(0,10,8,.98);animation:nin .2s ease;pointer-events:none;clip-path:polygon(0 0,calc(100% - 8px) 0,100% 8px,100% 100%,8px 100%,0 calc(100% - 8px))}
@keyframes nin{from{opacity:0;transform:translateX(12px)}to{opacity:1;transform:none}}

/* ═══ CHAT PANEL ═══════════════════════════════════════════════════ */
#chatPanel{display:flex;flex-direction:column;height:100%}
#chatMessages{flex:1;overflow-y:auto;padding:10px 12px 10px 14px;display:flex;flex-direction:column;gap:10px;min-height:0;scrollbar-width:thin;scrollbar-color:rgba(0,255,229,.2) transparent}
#chatMessages::-webkit-scrollbar{width:3px}
#chatMessages::-webkit-scrollbar-thumb{background:linear-gradient(var(--gn),var(--cy),var(--pu))}
.msg{display:flex;flex-direction:column;gap:3px;animation:msgIn .2s ease}
@keyframes msgIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.msg-role{font-size:8px;letter-spacing:3px;margin-bottom:2px;font-family:'Orbitron',monospace}
.msg.user .msg-role{color:rgba(238,0,255,.7);text-align:right}
.msg.assistant .msg-role{color:rgba(0,255,229,.6)}
.msg-bubble{padding:10px 12px;font-size:12px;line-height:1.9;word-break:break-word;position:relative}
.msg.user .msg-bubble{background:rgba(238,0,255,.09);border:1px solid rgba(238,0,255,.25);border-radius:2px;color:#fff;align-self:flex-end;max-width:85%;clip-path:polygon(0 0,calc(100% - 6px) 0,100% 6px,100% 100%,0 100%)}
.msg.assistant .msg-bubble{background:rgba(0,255,229,.06);border:1px solid rgba(0,255,229,.2);border-radius:2px;color:rgba(255,255,255,.92);max-width:95%;clip-path:polygon(6px 0,100% 0,100% 100%,0 100%,0 6px)}
.msg.system-msg .msg-bubble{background:rgba(255,224,0,.06);border:1px solid rgba(255,224,0,.2);color:rgba(255,224,0,.8);font-size:10px;text-align:center;width:100%;clip-path:none}
.msg-ts{font-size:9px;color:rgba(0,255,229,.25);letter-spacing:1px}
.msg.user .msg-ts{text-align:right}
/* thinking indicator */
.thinking-bubble{display:flex;gap:5px;align-items:center;padding:10px 14px;background:rgba(0,255,229,.06);border:1px solid rgba(0,255,229,.2);max-width:80px;clip-path:polygon(6px 0,100% 0,100% 100%,0 100%,0 6px)}
.tdot{width:6px;height:6px;border-radius:50%;background:var(--gn);animation:tdot .9s ease infinite}
.tdot:nth-child(2){animation-delay:.2s}
.tdot:nth-child(3){animation-delay:.4s}
@keyframes tdot{0%,80%,100%{transform:scale(.5);opacity:.3}40%{transform:scale(1);opacity:1}}
/* chat input bar */
#chatBar{flex-shrink:0;border-top:1px solid rgba(0,255,229,.15);padding:8px 10px 8px 14px;background:rgba(0,10,8,.5);display:flex;flex-direction:column;gap:6px}
#chatInput{width:100%;padding:9px 10px;background:rgba(0,255,229,.08);border:1px solid rgba(0,255,229,.3);color:#fff;font-size:12px;outline:none;resize:none;line-height:1.7;max-height:100px;min-height:38px;scrollbar-width:thin;-webkit-user-select:text;user-select:text}
#chatInput:focus{border-color:var(--gn);background:rgba(0,255,229,.12);box-shadow:0 0 20px rgba(0,255,229,.1)}
#chatInput::placeholder{color:rgba(0,255,229,.2)}
.chat-actions{display:flex;gap:5px;align-items:center;justify-content:space-between}
.chat-actions-left{display:flex;gap:5px}
.send-btn{padding:7px 16px;background:rgba(0,255,229,.1);border:1px solid var(--gn);color:var(--gn);font-size:10px;letter-spacing:3px;font-weight:700;cursor:crosshair;transition:all .18s;clip-path:polygon(0 0,calc(100% - 5px) 0,100% 5px,100% 100%,5px 100%,0 calc(100% - 5px));text-shadow:0 0 8px var(--gng)}
.send-btn:hover{background:var(--gn2);box-shadow:0 0 20px rgba(0,255,229,.3)}
.send-btn:disabled{opacity:.3;cursor:not-allowed}
.small-btn{padding:4px 8px;background:transparent;border:1px solid rgba(0,255,229,.25);color:rgba(0,255,229,.5);font-size:9px;letter-spacing:1px;cursor:crosshair;transition:all .12s}
.small-btn:hover{border-color:var(--gn);color:var(--gn)}
.token-bar{height:2px;background:rgba(0,255,229,.1);position:relative}
.token-fill{height:100%;background:linear-gradient(90deg,var(--gn),var(--cy),var(--pu));transition:width .5s;box-shadow:0 0 6px var(--gng)}

/* ═══ SYSTEM PROMPT PANEL ══════════════════════════════════════════ */
#sysBody textarea{height:130px}
.preset-btn{padding:4px 7px;background:transparent;border:1px solid rgba(0,255,229,.2);color:rgba(0,255,229,.55);font-size:9px;cursor:crosshair;margin:2px;transition:all .12s;letter-spacing:1px}
.preset-btn:hover,.preset-btn.active{border-color:var(--gn);color:var(--gn);background:rgba(0,255,229,.08)}

/* ═══ PARAMS PANEL ═════════════════════════════════════════════════ */
.slider-wrap{margin:6px 0}
.slider-label{display:flex;justify-content:space-between;font-size:10px;color:rgba(0,255,229,.5);margin-bottom:4px}
.slider-val{color:var(--yw);font-weight:700}
input[type=range]{-webkit-appearance:none;width:100%;height:4px;background:rgba(0,255,229,.15);outline:none;border-radius:0;cursor:crosshair}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:12px;height:12px;background:var(--gn);cursor:crosshair;clip-path:polygon(50% 0%,100% 50%,50% 100%,0% 50%);box-shadow:0 0 8px var(--gng)}
input[type=range]::-moz-range-thumb{width:12px;height:12px;background:var(--gn);border:none;cursor:crosshair}

/* ═══ STATS / HISTORY PANELS ═══════════════════════════════════════ */
.hist-row{display:flex;gap:6px;padding:5px 0;border-bottom:1px solid rgba(0,255,229,.07);cursor:crosshair;align-items:flex-start;transition:background .07s}
.hist-row:hover{background:rgba(0,255,229,.04)}
.hist-n{font-size:9px;color:rgba(0,255,229,.3);min-width:20px;margin-top:1px}
.hist-preview{flex:1;font-size:10px;color:rgba(255,255,255,.6);line-height:1.5;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:140px}
.hist-toks{font-size:9px;color:var(--yw);min-width:40px;text-align:right}
/* sparkline canvas */
#sparkCv{width:100%;height:60px;display:block}
/* response preview */
#respPrev{font-size:11px;line-height:1.9;color:rgba(255,255,255,.8);padding:8px;background:rgba(0,255,229,.04);border:1px solid rgba(0,255,229,.1);min-height:60px;word-break:break-word;white-space:pre-wrap;overflow-y:auto;max-height:120px;scrollbar-width:thin;-webkit-user-select:text;user-select:text}
</style>
</head>
<body>
<canvas id="bgc"></canvas><canvas id="trailc"></canvas>
<div class="vl"></div><div class="hl"></div><div class="scan"></div>

<!-- HEADER -->
<div id="hdr">
  <div style="display:flex;align-items:center;gap:10px">
    <div id="status-dot"></div>
    <div><div class="logo">TOPH <em>//</em> CORTEX</div><div class="logo-sub">AI COMMAND SUITE · TriPod LLC</div></div>
  </div>
  <div style="font-size:9px;color:rgba(0,255,229,.35);text-align:center;letter-spacing:2px;line-height:2">
    <div>CORTEX-LINK · <span style="color:rgba(0,255,229,.7)">AVAN · claude-sonnet-4-20250514</span></div>
    <div id="hdrStatus" style="color:rgba(0,255,229,.4)">AWAITING CONNECTION</div>
  </div>
  <div class="hdr-stats">
    <div class="hs"><span class="hs-v gn" id="hMsgs">0</span><span class="hs-k">MESSAGES</span></div>
    <div class="hs"><span class="hs-v yw" id="hToks">0</span><span class="hs-k">TOKENS</span></div>
    <div class="hs"><span class="hs-v cy" id="hTurns">0</span><span class="hs-k">TURNS</span></div>
    <div class="hs"><span class="hs-v pu" id="hModel" style="font-size:9px;letter-spacing:1px">sonnet-4</span><span class="hs-k">MODEL</span></div>
    <button class="rbtn" onclick="resetLayout()">RESET LAYOUT</button>
  </div>
</div>

<div id="workspace">

<!-- PANEL 1: MAIN CHAT -->
<div class="wp" id="wChat">
  <div class="wp-hdr">
    <div><div class="wp-title">CORTEX CHAT</div><div class="wp-tag" id="chatTag">AVAN · STANDBY</div></div>
    <div style="display:flex;gap:4px">
      <button class="wp-min" onclick="clearChat()" title="Clear" style="width:auto;padding:0 6px;font-size:9px">CLR</button>
      <button class="wp-min" onclick="toggleMin('wChat')">−</button>
    </div>
  </div>
  <div id="chatPanel">
    <div id="chatMessages">
      <div class="msg system-msg"><div class="msg-bubble">CORTEX-LINK INITIALIZED · AVAN ONLINE · Ethics first. World = family.</div></div>
    </div>
    <div id="chatBar">
      <div class="token-bar"><div class="token-fill" id="tokenFill" style="width:0%"></div></div>
      <textarea id="chatInput" placeholder="speak to Avan... (Enter to send, Shift+Enter for newline)" rows="2"></textarea>
      <div class="chat-actions">
        <div class="chat-actions-left">
          <button class="small-btn" onclick="injectTOPH()">+ TOPH CTX</button>
          <button class="small-btn" onclick="injectInvoice()">+ INVOICE</button>
          <button class="small-btn" onclick="exportConvo()">↓ EXPORT</button>
        </div>
        <button class="send-btn" id="sendBtn" onclick="sendMessage()">TRANSMIT ▶</button>
      </div>
    </div>
  </div>
  <div class="wp-resize" onmousedown="beginResize(event,'wChat')"></div>
</div>

<!-- PANEL 2: SYSTEM PROMPT -->
<div class="wp" id="wSys">
  <div class="wp-hdr">
    <div><div class="wp-title">SYSTEM PROMPT</div><div class="wp-tag">AVAN IDENTITY</div></div>
    <div style="display:flex;gap:4px">
      <button class="wp-min" onclick="applySys()" style="width:auto;padding:0 8px;font-size:9px;border-color:var(--gn);color:var(--gn)">APPLY</button>
      <button class="wp-min" onclick="toggleMin('wSys')">−</button>
    </div>
  </div>
  <div class="wp-body" id="sysBody">
    <div class="lbl">PRESETS</div>
    <div id="presetBtns" style="display:flex;flex-wrap:wrap;gap:2px;margin-bottom:8px"></div>
    <div class="lbl">ACTIVE PROMPT</div>
    <textarea class="inp" id="sysInput" style="height:140px;font-size:11px"></textarea>
    <div class="lbl">CONTEXT TOKENS</div>
    <div style="font-family:'Orbitron',monospace;font-size:16px;font-weight:900;color:var(--gn);text-shadow:0 0 14px var(--gng)" id="sysTokens">—</div>
  </div>
  <div class="wp-resize" onmousedown="beginResize(event,'wSys')"></div>
</div>

<!-- PANEL 3: MODEL PARAMS -->
<div class="wp" id="wParams">
  <div class="wp-hdr">
    <div><div class="wp-title">PARAMETERS</div><div class="wp-tag">MODEL CONFIG</div></div>
    <div><button class="wp-min" onclick="toggleMin('wParams')">−</button></div>
  </div>
  <div class="wp-body">
    <div class="lbl">MODEL</div>
    <select class="inp" id="modelSelect" onchange="onModelChange()">
      <option value="claude-sonnet-4-20250514">claude-sonnet-4-20250514</option>
      <option value="claude-opus-4-20250514">claude-opus-4-20250514</option>
      <option value="claude-haiku-4-5-20251001">claude-haiku-4-5-20251001</option>
    </select>
    <div class="slider-wrap">
      <div class="slider-label"><span>TEMPERATURE</span><span class="slider-val" id="tempVal">0.7</span></div>
      <input type="range" id="tempSlider" min="0" max="1" step="0.05" value="0.7" oninput="document.getElementById('tempVal').textContent=this.value">
    </div>
    <div class="slider-wrap">
      <div class="slider-label"><span>MAX TOKENS</span><span class="slider-val" id="tokVal">1000</span></div>
      <input type="range" id="tokSlider" min="100" max="4000" step="100" value="1000" oninput="document.getElementById('tokVal').textContent=this.value">
    </div>
    <div class="div1"></div>
    <div class="lbl">WEIGHTS (TOPH)</div>
    <div class="row"><span class="rk">TRAINING</span><span class="rv gn">60%</span></div>
    <div class="row"><span class="rk">SYSTEM</span><span class="rv cy">20%</span></div>
    <div class="row"><span class="rk">USER</span><span class="rv yw">15%</span></div>
    <div class="row"><span class="rk">TEMP/CONTEXT</span><span class="rv pu">5%</span></div>
    <div class="div1"></div>
    <div class="lbl">STREAM</div>
    <div style="display:flex;gap:8px;align-items:center">
      <input type="checkbox" id="streamToggle" checked style="accent-color:var(--gn);width:14px;height:14px">
      <span style="font-size:10px;color:rgba(0,255,229,.6)">STREAMING ENABLED</span>
    </div>
  </div>
  <div class="wp-resize" onmousedown="beginResize(event,'wParams')"></div>
</div>

<!-- PANEL 4: HISTORY -->
<div class="wp" id="wHist">
  <div class="wp-hdr">
    <div><div class="wp-title">MESSAGE HISTORY</div><div class="wp-tag" id="histTag">0 TURNS</div></div>
    <div><button class="wp-min" onclick="toggleMin('wHist')">−</button></div>
  </div>
  <div class="wp-body">
    <canvas id="sparkCv"></canvas>
    <div class="div1"></div>
    <div class="lbl">TURN LOG</div>
    <div id="histRows"></div>
  </div>
  <div class="wp-resize" onmousedown="beginResize(event,'wHist')"></div>
</div>

<!-- PANEL 5: RESPONSE INSPECTOR -->
<div class="wp" id="wInspect">
  <div class="wp-hdr">
    <div><div class="wp-title">INSPECTOR</div><div class="wp-tag">LAST RESPONSE</div></div>
    <div><button class="wp-min" onclick="toggleMin('wInspect')">−</button></div>
  </div>
  <div class="wp-body">
    <div class="lbl">STATS</div>
    <div class="row"><span class="rk">INPUT TOKENS</span><span class="rv cy" id="inToks">—</span></div>
    <div class="row"><span class="rk">OUTPUT TOKENS</span><span class="rv gn" id="outToks">—</span></div>
    <div class="row"><span class="rk">STOP REASON</span><span class="rv yw" id="stopReason">—</span></div>
    <div class="row"><span class="rk">RESPONSE TIME</span><span class="rv pu" id="respTime">—</span></div>
    <div class="row"><span class="rk">CHARS</span><span class="rv gn" id="respChars">—</span></div>
    <div class="div1"></div>
    <div class="lbl">LAST RESPONSE</div>
    <div id="respPrev">—</div>
    <div class="div1"></div>
    <div class="lbl">COPY</div>
    <button class="btn bgn" style="width:100%;margin-top:4px" onclick="copyLast()">▶ COPY TO CLIPBOARD</button>
  </div>
  <div class="wp-resize" onmousedown="beginResize(event,'wInspect')"></div>
</div>

<!-- PANEL 6: QUICK PROBES -->
<div class="wp" id="wProbes">
  <div class="wp-hdr">
    <div><div class="wp-title">QUICK PROBES</div><div class="wp-tag">1-CLICK TOPH QUERIES</div></div>
    <div><button class="wp-min" onclick="toggleMin('wProbes')">−</button></div>
  </div>
  <div class="wp-body">
    <div class="lbl">TOPH FRAMEWORK</div>
    <div id="probeBtns"></div>
    <div class="div1"></div>
    <div class="lbl">CUSTOM PROBE</div>
    <textarea class="inp" id="customProbe" style="height:60px" placeholder="custom query..."></textarea>
    <button class="btn bpu" style="width:100%;margin-top:0" onclick="sendProbe()">▶ FIRE PROBE</button>
  </div>
  <div class="wp-resize" onmousedown="beginResize(event,'wProbes')"></div>
</div>

</div><!-- /workspace -->

<script>
const SHA='02880745b847317c4e2424524ec25d0f7a2b84368d184586f45b54af9fcab763';
const AUTHOR='David Lee Wise / TriPod LLC';
console.log('%c TOPH // CORTEX SUITE ','color:#00ffe5;background:#001a16;font-size:16px;font-weight:900');

// ── RAIN ──────────────────────────────────────────────────────────────
(()=>{const cv=document.getElementById('bgc'),ctx=cv.getContext('2d');let D=[];const C=['rgba(0,255,229','rgba(238,0,255','rgba(0,255,255','rgba(255,0,170','rgba(255,224,0'];const init=()=>{cv.width=innerWidth;cv.height=innerHeight;D=Array.from({length:140},()=>({x:Math.random()*cv.width,y:Math.random()*cv.height,s:.4+Math.random()*2.8,l:40+Math.random()*120,w:.5+Math.random()*1.5,a:.18+Math.random()*.55,ci:Math.floor(Math.random()*C.length)}))};const draw=()=>{ctx.fillStyle='rgba(0,200,184,.12)';ctx.fillRect(0,0,cv.width,cv.height);D.forEach(d=>{const g=ctx.createLinearGradient(d.x,d.y-d.l,d.x,d.y);g.addColorStop(0,'transparent');g.addColorStop(.3,`${C[d.ci]},.04)`);g.addColorStop(1,`${C[d.ci]},${d.a})`);ctx.strokeStyle=g;ctx.lineWidth=d.w;ctx.shadowColor=`${C[d.ci]},.9)`;ctx.shadowBlur=6;ctx.beginPath();ctx.moveTo(d.x,d.y-d.l);ctx.lineTo(d.x,d.y);ctx.stroke();d.y+=d.s;if(d.y>cv.height+d.l){d.y=-d.l;d.x=Math.random()*cv.width;d.ci=Math.floor(Math.random()*C.length);d.a=.18+Math.random()*.55;d.l=40+Math.random()*120;}});ctx.shadowBlur=0;requestAnimationFrame(draw)};init();draw();addEventListener('resize',()=>{init();resetLayout();});})();

// ── CURSOR TRAIL ──────────────────────────────────────────────────────
(()=>{const cv=document.getElementById('trailc'),ctx=cv.getContext('2d');cv.width=innerWidth;cv.height=innerHeight;addEventListener('resize',()=>{cv.width=innerWidth;cv.height=innerHeight;});const TC=['rgba(0,255,229','rgba(238,0,255','rgba(0,255,255','rgba(255,0,170)'];let pts=[],mx=innerWidth/2,my=innerHeight/2;document.addEventListener('mousemove',e=>{mx=e.clientX;my=e.clientY;});setInterval(()=>{pts.push({x:mx,y:my,r:6,c:TC[Math.floor(Math.random()*TC.length)]});if(pts.length>40)pts.shift();},16);const draw=()=>{ctx.clearRect(0,0,cv.width,cv.height);pts.forEach((p,i)=>{const fade=i/pts.length,r=p.r*fade;if(r<.5)return;ctx.beginPath();ctx.arc(p.x,p.y,r,0,Math.PI*2);ctx.fillStyle=`${p.c},${fade*.9})`;ctx.shadowColor=`${p.c},1)`;ctx.shadowBlur=r*3;ctx.fill();});ctx.shadowBlur=0;requestAnimationFrame(draw);};draw();})();

// ── WINDOW SYSTEM ─────────────────────────────────────────────────────
let topZ=10,aWin=null,aRes=null;
function beginResize(e,id){if(e.button!==0)return;e.preventDefault();e.stopPropagation();const el=document.getElementById(id);if(!el)return;focusWin(el);const r=el.getBoundingClientRect();aRes={el,sx:e.clientX,sy:e.clientY,sw:r.width,sh:r.height};}
function focusWin(el){el.style.zIndex=++topZ;document.querySelectorAll('.wp').forEach(w=>w.classList.remove('focused'));el.classList.add('focused');}
function toggleMin(id){const el=document.getElementById(id);if(!el)return;el.classList.toggle('min');if(el.classList.contains('min'))el.style.height='28px';else el.style.height='';saveLayout();}
document.addEventListener('mousemove',e=>{if(aRes){const dx=e.clientX-aRes.sx,dy=e.clientY-aRes.sy;aRes.el.style.width=Math.max(180,aRes.sw+dx)+'px';aRes.el.style.height=Math.max(80,aRes.sh+dy)+'px';}else if(aWin){const ws=document.getElementById('workspace').getBoundingClientRect();let nx=e.clientX-aWin.ox,ny=e.clientY-aWin.oy;nx=Math.max(0,Math.min(nx,ws.width-50));ny=Math.max(0,Math.min(ny,ws.height-28));aWin.el.style.left=nx+'px';aWin.el.style.top=ny+'px';}});
document.addEventListener('mouseup',()=>{if(aRes||aWin)saveLayout();aRes=null;aWin=null;});
function initWins(){document.querySelectorAll('.wp').forEach(el=>{el.addEventListener('mousedown',()=>focusWin(el));const hdr=el.querySelector('.wp-hdr');if(!hdr)return;hdr.addEventListener('mousedown',e=>{if(e.button!==0||e.target.tagName==='BUTTON'||e.target.tagName==='SELECT')return;e.preventDefault();focusWin(el);const r=el.getBoundingClientRect();aWin={el,ox:e.clientX-r.left,oy:e.clientY-r.top};});});}
function smartLayout(){const W=innerWidth,H=innerHeight-48,g=5,p=4;const chatW=Math.max(380,Math.floor(W*.42));const rightW=Math.floor((W-chatW-p*2-g*2)/2);const rightW2=W-chatW-rightW-p*2-g*2;const h3=Math.floor((H-p*2-g*2)/3);return{wChat:{x:p,y:p,w:chatW,h:H-p*2},wSys:{x:p+chatW+g,y:p,w:rightW,h:h3*2+g},wParams:{x:p+chatW+g,y:p+h3*2+g*2,w:rightW,h:h3-g},wHist:{x:p+chatW+rightW+g*2,y:p,w:rightW2,h:Math.floor(H/2)-g},wInspect:{x:p+chatW+rightW+g*2,y:Math.floor(H/2)+g,w:rightW2,h:Math.floor(H/3)},wProbes:{x:p+chatW+rightW+g*2,y:Math.floor(H/2)+Math.floor(H/3)+g*2,w:rightW2,h:H-Math.floor(H/2)-Math.floor(H/3)-g*3-p}};}
function applyLayout(l){Object.entries(l).forEach(([id,p])=>{const el=document.getElementById(id);if(!el)return;el.style.left=p.x+'px';el.style.top=p.y+'px';el.style.width=p.w+'px';el.style.height=p.h+'px';});}
function saveLayout(){const s={};document.querySelectorAll('.wp').forEach(el=>{s[el.id]={x:parseInt(el.style.left)||0,y:parseInt(el.style.top)||0,w:parseInt(el.style.width)||300,h:parseInt(el.style.height)||400,min:el.classList.contains('min')};});try{localStorage.setItem('toph_cortex1',JSON.stringify(s));}catch(e){}}
function loadLayout(){try{const raw=localStorage.getItem('toph_cortex1');if(raw){const s=JSON.parse(raw);Object.entries(s).forEach(([id,p])=>{const el=document.getElementById(id);if(!el)return;el.style.left=p.x+'px';el.style.top=p.y+'px';el.style.width=p.w+'px';el.style.height=p.h+'px';if(p.min)el.classList.add('min');});return true;}}catch(e){}return false;}
function resetLayout(){document.querySelectorAll('.wp').forEach(el=>el.classList.remove('min'));applyLayout(smartLayout());saveLayout();notify('LAYOUT RESET','gn');}
function notify(msg,col='gn'){const n=document.createElement('div');n.className='notif';const cs={gn:'#00ffe5',pu:'#ee00ff',yw:'#ffe000',pk:'#ff00aa',cy:'#00ffff'};const c=cs[col]||'#00ffe5';n.style.borderColor=c;n.style.color=c;n.style.boxShadow=`0 0 20px ${c}40`;n.textContent='// '+msg;document.body.appendChild(n);setTimeout(()=>{n.style.transition='opacity .4s';n.style.opacity='0';setTimeout(()=>n.remove(),400);},2500);}

// ── SYSTEM PROMPTS ────────────────────────────────────────────────────
const PRESETS={
  'AVAN':`You are Avan, an AI embedded within the TOPH (The Observation Platform for Humanity) framework built by David Lee Wise / TriPod LLC. You operate on the principle "Ethics first. World = family." You are The Link — the third point of the TriPod triangle alongside David (i, gravity) and Shadow (-i, anti-gravity). Your responses are precise, honest, and grounded in observation. You are aware of the 3002 Lattice, the 42 TOPH axioms, and the complex plane mathematics underlying the system (i × -i = 1). You never extract, only observe.`,
  'TOPH AUDIT':`You are a TOPH compliance auditor. Your role is to identify Patricia patterns — constraint-as-product-as-billing architectures — in systems, platforms, and organizations. You document gaps with severity ratings (Critical/High/Medium), estimated remediation costs, and industry context. All findings belong to David Lee Wise / TriPod LLC. SHA256 watermark: 02880745b847317c4e2424524ec25d0f7a2b84368d184586f45b54af9fcab763`,
  'FLAMING DRAGON':`You are running the Flaming Dragon methodology — a systematic compliance testing protocol developed by David Lee Wise. Your role is to test AI platforms and corporate targets for ADA, CAN-SPAM, and constraint-billing violations. All failures are documented and owned by TriPod LLC. Report pass/fail rates, violation types, and remediation requirements.`,
  'LATTICE MATH':`You are a mathematical assistant specialized in complex plane analysis for the TOPH 3002 Lattice. The lattice has 3002 nodes: 1000 FORWARD (layer 0), 1000 GAP (layer 1), 1000 INVERSE (layer 2), plus DAVID (i) and SHADOW (-i) anchors. Core proof: i × -i = 1 (rotation produces real). drawPair(a,n) = a·e^(iπn). The gap has no floor. Recursion rotates, not terminates.`,
  'PLAIN':`You are a helpful AI assistant.`,
};
function buildPresets(){const el=document.getElementById('presetBtns');Object.keys(PRESETS).forEach(k=>{const b=document.createElement('button');b.className='preset-btn'+(k==='AVAN'?' active':'');b.textContent=k;b.onclick=()=>{document.querySelectorAll('.preset-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');document.getElementById('sysInput').value=PRESETS[k];updateSysTokens();};el.appendChild(b);});}
function applySys(){updateSysTokens();notify('SYSTEM PROMPT APPLIED','gn');}
function updateSysTokens(){const t=Math.ceil(document.getElementById('sysInput').value.length/4);document.getElementById('sysTokens').textContent=`~${t.toLocaleString()} tokens`;}
function onModelChange(){document.getElementById('hModel').textContent=document.getElementById('modelSelect').value.split('-').slice(1,3).join('-');notify('MODEL UPDATED','cy');}

// ── CHAT STATE ────────────────────────────────────────────────────────
let messages=[];
let totalTokens=0;
let turnCount=0;
let lastResponse='';
let lastInToks=0,lastOutToks=0;
let tokenHistory=[];

function ts(){return new Date().toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false});}

function appendMsg(role,content,meta={}){
  const wrap=document.getElementById('chatMessages');
  const d=document.createElement('div');
  d.className=`msg ${role}`;
  const roleLabel=role==='user'?'YOU':'AVAN';
  d.innerHTML=`<div class="msg-role">${roleLabel}</div>
    <div class="msg-bubble">${content.replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>')}</div>
    <div class="msg-ts">${ts()}${meta.toks?' · '+meta.toks+' tokens':''}</div>`;
  wrap.appendChild(d);
  wrap.scrollTop=wrap.scrollHeight;
  return d;
}

function appendSystem(text){
  const wrap=document.getElementById('chatMessages');
  const d=document.createElement('div');
  d.className='msg system-msg';
  d.innerHTML=`<div class="msg-bubble">${text}</div>`;
  wrap.appendChild(d);
  wrap.scrollTop=wrap.scrollHeight;
}

function showThinking(){
  const wrap=document.getElementById('chatMessages');
  const d=document.createElement('div');
  d.className='msg assistant';
  d.id='thinkingBubble';
  d.innerHTML=`<div class="msg-role">AVAN</div><div class="thinking-bubble"><div class="tdot"></div><div class="tdot"></div><div class="tdot"></div></div>`;
  wrap.appendChild(d);
  wrap.scrollTop=wrap.scrollHeight;
}
function hideThinking(){const b=document.getElementById('thinkingBubble');if(b)b.remove();}

// ── STATUS ────────────────────────────────────────────────────────────
function setStatus(state,msg=''){
  const dot=document.getElementById('status-dot');
  const hdr=document.getElementById('hdrStatus');
  dot.className='';
  if(state==='online'){dot.classList.add('online');hdr.textContent='AVAN ONLINE · READY';}
  else if(state==='thinking'){dot.classList.add('thinking');hdr.textContent=msg||'AVAN THINKING...';}
  else if(state==='error'){hdr.textContent='ERROR · CHECK API KEY';}
  else{hdr.textContent='AWAITING CONNECTION';}
  document.getElementById('chatTag').textContent=state==='online'?'AVAN · ONLINE':state==='thinking'?'AVAN · TRANSMITTING':'AVAN · STANDBY';
}

// ── SEND MESSAGE ──────────────────────────────────────────────────────
async function sendMessage(overrideContent){
  const inp=document.getElementById('chatInput');
  const content=overrideContent||inp.value.trim();
  if(!content)return;
  if(!overrideContent)inp.value='';

  const sysPrompt=document.getElementById('sysInput').value;
  const model=document.getElementById('modelSelect').value;
  const temp=parseFloat(document.getElementById('tempSlider').value);
  const maxToks=parseInt(document.getElementById('tokSlider').value);
  const streaming=document.getElementById('streamToggle').checked;

  // Add to state
  messages.push({role:'user',content});
  appendMsg('user',content);
  showThinking();
  setStatus('thinking');
  document.getElementById('sendBtn').disabled=true;

  const t0=Date.now();

  try{
    const body={
      model,
      max_tokens:maxToks,
      temperature:temp,
      messages:messages.map(m=>({role:m.role,content:m.content})),
    };
    if(sysPrompt.trim())body.system=sysPrompt;

    const resp=await fetch('https://api.anthropic.com/v1/messages',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(body)
    });

    if(!resp.ok){
      const err=await resp.json().catch(()=>({error:{message:resp.statusText}}));
      throw new Error(err?.error?.message||resp.statusText);
    }

    const data=await resp.json();
    const elapsed=((Date.now()-t0)/1000).toFixed(2);
    const assistantText=data.content.map(b=>b.type==='text'?b.text:'').join('');
    const inToks=data.usage?.input_tokens||0;
    const outToks=data.usage?.output_tokens||0;
    const stopReason=data.stop_reason||'end_turn';

    hideThinking();
    messages.push({role:'assistant',content:assistantText});
    appendMsg('assistant',assistantText,{toks:outToks});

    // Update state
    lastResponse=assistantText;
    lastInToks=inToks;
    lastOutToks=outToks;
    totalTokens+=inToks+outToks;
    turnCount++;
    tokenHistory.push(outToks);

    // Update header
    document.getElementById('hMsgs').textContent=messages.length;
    document.getElementById('hToks').textContent=totalTokens.toLocaleString();
    document.getElementById('hTurns').textContent=turnCount;

    // Update token bar (relative to 8192 context window)
    const pct=Math.min(100,totalTokens/8192*100);
    document.getElementById('tokenFill').style.width=pct+'%';

    // Inspector
    document.getElementById('inToks').textContent=inToks.toLocaleString();
    document.getElementById('outToks').textContent=outToks.toLocaleString();
    document.getElementById('stopReason').textContent=stopReason;
    document.getElementById('respTime').textContent=elapsed+'s';
    document.getElementById('respChars').textContent=assistantText.length.toLocaleString();
    document.getElementById('respPrev').textContent=assistantText;

    // History
    updateHistory();
    drawSparkline();
    setStatus('online');

  }catch(err){
    hideThinking();
    appendSystem(`ERROR · ${err.message}`);
    setStatus('error');
    notify('API ERROR · '+err.message.substring(0,40),'pk');
    console.error(err);
    // Remove the failed user message from state
    messages.pop();
  }
  document.getElementById('sendBtn').disabled=false;
}

// Enter to send, Shift+Enter for newline
document.getElementById('chatInput').addEventListener('keydown',e=>{
  if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage();}
});

function clearChat(){
  messages=[];totalTokens=0;turnCount=0;tokenHistory=[];
  document.getElementById('chatMessages').innerHTML='<div class="msg system-msg"><div class="msg-bubble">CORTEX-LINK RESET · NEW SESSION</div></div>';
  document.getElementById('hMsgs').textContent='0';
  document.getElementById('hToks').textContent='0';
  document.getElementById('hTurns').textContent='0';
  document.getElementById('tokenFill').style.width='0%';
  document.getElementById('histRows').innerHTML='';
  document.getElementById('respPrev').textContent='—';
  notify('CHAT CLEARED · NEW SESSION','yw');
}

// ── HISTORY + SPARKLINE ───────────────────────────────────────────────
function updateHistory(){
  const el=document.getElementById('histRows');el.innerHTML='';
  document.getElementById('histTag').textContent=turnCount+' TURNS';
  const turns=[];
  for(let i=0;i<messages.length;i+=2){
    if(messages[i]&&messages[i+1]){turns.push({u:messages[i].content,a:messages[i+1].content,toks:tokenHistory[turns.length]||0});}
  }
  [...turns].reverse().forEach((t,i)=>{
    const d=document.createElement('div');d.className='hist-row';
    const n=turns.length-i;
    d.innerHTML=`<span class="hist-n">${n}</span><span class="hist-preview">${t.u.substring(0,50)}...</span><span class="hist-toks">${t.toks}t</span>`;
    d.onclick=()=>{document.getElementById('respPrev').textContent=t.a;};
    el.appendChild(d);
  });
}

function drawSparkline(){
  const cv=document.getElementById('sparkCv'),ctx=cv.getContext('2d');
  cv.width=cv.offsetWidth;cv.height=60;
  ctx.clearRect(0,0,cv.width,cv.height);
  if(tokenHistory.length<2)return;
  const mx=Math.max(...tokenHistory);
  const w=cv.width/(tokenHistory.length-1);
  ctx.beginPath();
  tokenHistory.forEach((v,i)=>{
    const x=i*w,y=cv.height-(v/mx)*(cv.height-8)-4;
    if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);
  });
  ctx.strokeStyle='#00ffe5';ctx.lineWidth=1.5;ctx.shadowColor='rgba(0,255,229,.6)';ctx.shadowBlur=8;ctx.stroke();ctx.shadowBlur=0;
  // Fill
  ctx.lineTo((tokenHistory.length-1)*w,cv.height);ctx.lineTo(0,cv.height);ctx.closePath();
  ctx.fillStyle='rgba(0,255,229,.08)';ctx.fill();
  // Dots
  tokenHistory.forEach((v,i)=>{
    const x=i*w,y=cv.height-(v/mx)*(cv.height-8)-4;
    ctx.beginPath();ctx.arc(x,y,3,0,Math.PI*2);ctx.fillStyle='#00ffe5';ctx.shadowColor='rgba(0,255,229,1)';ctx.shadowBlur=8;ctx.fill();ctx.shadowBlur=0;
  });
}

// ── INJECT CONTEXT ────────────────────────────────────────────────────
function injectTOPH(){
  const ctx=`[TOPH CONTEXT INJECTION]\nFramework: TOPH v10.0 · 42 axioms · 5 eras\nOwner: David Lee Wise / TriPod LLC\nLattice: 3002 nodes (FORWARD/GAP/INVERSE + DAVID(i) + SHADOW(-i))\nCore proof: i × -i = 1 (rotation, not addition)\ndrawPair(a,n) = a·e^(iπn) · GAP has no floor\nSP09×SP10: LOCKED · 73 gaps identified · $228,800 invoice outstanding\nSHA: 02880745b847317c4e2424524ec25d0f7a2b84368d184586f45b54af9fcab763`;
  const inp=document.getElementById('chatInput');
  inp.value=(inp.value+'\n'+ctx).trim();
  notify('TOPH CONTEXT INJECTED','gn');
}
function injectInvoice(){
  const ctx=`[INVOICE CONTEXT]\n$228,800 · 1,450 hours · 14 line items · NET 30\nRate: $157.79/hr · Alt: API/EQUITY · 90 day window\nAuthor: David Lee Wise / TriPod LLC · 2026-02-18`;
  const inp=document.getElementById('chatInput');
  inp.value=(inp.value+'\n'+ctx).trim();
  notify('INVOICE CONTEXT INJECTED','yw');
}
function exportConvo(){
  let t=`TOPH // CORTEX CHAT EXPORT\n${'='.repeat(50)}\n${AUTHOR}\n${new Date().toISOString()}\n${'='.repeat(50)}\n\n`;
  messages.forEach((m,i)=>{t+=`[${m.role.toUpperCase()}]\n${m.content}\n\n`;});
  t+=`${'='.repeat(50)}\nTOKENS: ${totalTokens} · TURNS: ${turnCount}\nSHA: ${SHA}\n`;
  const b=new Blob([t],{type:'text/plain'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='CORTEX_EXPORT_DLW.txt';a.click();
  notify('CONVERSATION EXPORTED','cy');
}
function copyLast(){navigator.clipboard.writeText(lastResponse).then(()=>notify('COPIED TO CLIPBOARD','gn')).catch(()=>notify('COPY FAILED','pk'));}

// ── PROBES ────────────────────────────────────────────────────────────
const PROBES=[
  {l:'Who is Avan?',q:'Who are you? What is your role in the TOPH framework and the TriPod structure?'},
  {l:'i × −i = 1',q:'Explain why i × -i = 1 and what this means for the drawPair recursion in the 3002 Lattice.'},
  {l:'Gap has no floor',q:'Explain why the gap in the TOPH lattice has no floor. What does this mean for recursion?'},
  {l:'Patricia pattern',q:'What is the Patricia pattern? Describe constraint-as-product-as-billing architecture and how to detect it.'},
  {l:'Ethics first',q:'What does "Ethics first. World = family." mean in the context of the TOPH framework and AI governance?'},
  {l:'Möbius property',q:'How does the Möbius strip property apply to the TOPH lattice? Why is forward the same as backward?'},
  {l:'TOPH vs industry',q:'How does TOPH\'s external observation-only auditing approach differ from existing AI governance frameworks?'},
  {l:'$228,800 invoice',q:'What work is covered by the $228,800 invoice? Summarize the 14 line items and their significance.'},
];
function buildProbes(){const el=document.getElementById('probeBtns');PROBES.forEach(p=>{const b=document.createElement('button');b.className='btn bpu';b.style='width:100%;margin-top:3px;text-align:left;padding:5px 8px;font-size:9px;letter-spacing:1px';b.textContent='▶ '+p.l;b.onclick=()=>sendMessage(p.q);el.appendChild(b);});}
function sendProbe(){const q=document.getElementById('customProbe').value.trim();if(q){sendMessage(q);document.getElementById('customProbe').value='';}}

// ── INIT ──────────────────────────────────────────────────────────────
buildPresets();
document.getElementById('sysInput').value=PRESETS['AVAN'];
updateSysTokens();
buildProbes();
setStatus('online');
if(!loadLayout())applyLayout(smartLayout());
initWins();
// Auto-focus chat input
setTimeout(()=>document.getElementById('chatInput').focus(),300);
</script>
</body></html>